@startuml
box "DIRECTOR"
	participant director
 end box


 box "USERS" #LightBlue
	participant operator
	participant cfuser
 end box


box "CF"
participant cloudfoundry
participant cfapp
end box


box "BOSH-ON-DEMAND" #LightBlue
participant        broker
participant        boshdeployer
participant        director
end box


box "BOSH-ON-DEMAND-SERVICE"
participant servicevm
participant serviceaccessvm
end box


operator -> director: upload stemcell
operator -> director: upload release
operator -> director: configure cloud config


cfuser -> cloudfoundry: create service
cloudfoundry -> broker: create service
broker -> boshdeployer: create deployment
boshdeployer -> director: bosh deploy
director -> servicevm: create
director -> serviceaccessvm: create

== bind service ==

cfuser -> cloudfoundry: cf push
cfuser -> cloudfoundry: cf bind-service
cloudfoundry -> broker: bind-service

cfuser -> cloudfoundry: cf restage
cloudfoundry -> cfapp: inject credentials

== use service ==

cfapp -> serviceaccessvm: access
serviceaccessvm -> servicevm : relay




hide footbox
@enduml